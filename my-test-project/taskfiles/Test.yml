# https://taskfile.dev

version: '3'

vars:
  UV_RUN: "uv run --env-file .env"

tasks:
  default:
    desc: Run the tests
    deps:
      - :env
    cmds:
      - "{{.UV_RUN}} pytest --reuse-db -x {{.CLI_ARGS}}"

  fast:
    desc: Run tests without coverage (faster)
    deps:
      - :env
    cmds:
      - "{{.UV_RUN}} pytest --reuse-db -x --no-cov {{.CLI_ARGS}}"

  coverage:
    desc: Run tests with coverage report
    deps:
      - :env
    cmds:
      - "{{.UV_RUN}} pytest --cov --cov-report=html --cov-report=term-missing {{.CLI_ARGS}}"
      - echo "Coverage report generated at htmlcov/index.html"

  unit:
    desc: Run only unit tests (fast, no database)
    deps:
      - :env
    cmds:
      - "{{.UV_RUN}} pytest -m 'not integration' --reuse-db {{.CLI_ARGS}}"

  integration:
    desc: Run only integration tests
    deps:
      - :env
    cmds:
      - "{{.UV_RUN}} pytest -m integration --reuse-db {{.CLI_ARGS}}"

  failed:
    desc: Re-run only failed tests
    deps:
      - :env
    cmds:
      - "{{.UV_RUN}} pytest --lf --reuse-db {{.CLI_ARGS}}"
